#!/bin/bash
name=$(sed 's/\"//g' <<< $NAME)
if [[ ! $name =~ ^([0-9A-F]{2}[:-]){5}([0-9A-F]{2})$ ]]; then exit 0;  fi

bt_name=`grep Name /var/lib/bluetooth/*/$name/info | awk -F'=' '{print $2}'`

action=$(expr "$ACTION" : "\([a-zA-Z]\+\).*")
logger "Action: $action"

if [ "$action" = "add" ]; then
    logger "[$(basename $0)] Bluetooth device is being added [$name] - $bt_name"
    bluetoothctl << EOT
discoverable off
EOT
    #espeak "Device, $bt_name Connected"
    #ogg123 -q -d pulse /usr/share/sounds/freedesktop/stereo/device-added.oga
    #ifconfig wlan0 down
fi

if [ "$action" = "remove" ]; then
    logger "[$(basename $0)] Bluetooth device is being removed [$name] - $bt_name"
    #ifconfig wlan0 up
    #espeak "Device, $bt_name Disconnected"
    #ogg123 -q -d pulse /usr/share/sounds/freedesktop/stereo/device-removed.oga
    bluetoothctl << EOT
discoverable on
EOT
fi
